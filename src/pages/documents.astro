---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Fetch documents from CMS content
const allDocuments = await getCollection('documents');

// Sort documents by date (newest first)
const sortedDocuments = allDocuments.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Helper for formatting dates in French
const formatDate = (date: Date) => {
  return date.toLocaleDateString('fr-FR', {
    day: 'numeric',
    month: 'long',
    year: 'numeric'
  });
};
---

<Layout title="Documents utiles">
  <div class="bg-slate-50 py-12 min-h-[50vh]">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      
      <!-- Page Header -->
      <div class="text-center mb-12">
        <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4">Documents Utiles</h1>
        <p class="text-slate-600 max-w-2xl mx-auto">
          Retrouvez ici l'ensemble des documents administratifs, bulletins d'information et fiches pratiques à télécharger.
        </p>
      </div>

      <!-- Documents Table -->
      <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-slate-200">
            <thead class="bg-slate-50">
              <tr>
                <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">
                  Document / Description
                </th>
                <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider whitespace-nowrap">
                  Date de dépôt
                </th>
                <th scope="col" class="px-6 py-4 text-right text-xs font-semibold text-slate-500 uppercase tracking-wider">
                  Action
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-slate-200">
              {sortedDocuments.map((doc) => (
                <tr class="hover:bg-slate-50 transition-colors">
                  <td class="px-6 py-4">
                    <div class="flex flex-col">
                      <span class="text-sm font-bold text-slate-900">{doc.data.title}</span>
                      <span class="text-sm text-slate-500 mt-1">{doc.data.description}</span>
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">
                    {formatDate(doc.data.date)}
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <a 
                      href={doc.data.file} 
                      download
                      class="inline-flex items-center px-4 py-2 border border-slate-300 shadow-sm text-sm font-medium rounded-md text-slate-700 bg-white hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 transition"
                    >
                      <svg class="-ml-1 mr-2 h-4 w-4 text-slate-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                      </svg>
                      Télécharger
                    </a>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        
        {sortedDocuments.length === 0 && (
            <div class="text-center py-12 text-slate-500">
                Aucun document disponible pour le moment.
            </div>
        )}
      </div>

    </div>
  </div>
</Layout>
